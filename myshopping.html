<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title></title>
	<link rel="stylesheet" type="text/css" href="css/iconfont.css">
	<link rel="stylesheet" type="text/css" href="css/public.css">
	<link rel="stylesheet" type="text/css" href="css/myshopping.css">
	<meta http-equiv="Expires" content="0">
	<meta http-equiv="Pragma" content="no-cache">
	<meta http-equiv="Cache-control" content="no-cache">
	<meta http-equiv="Cache" content="no-cache">
</head>
<body>
	<!--
    	作者：offline
    	时间：2018-01-18
    	描述：搜索遮罩层
    -->
    <div id="searchDiv" class="searchDiv">
    		<div id="closeSearch"><div></div></div>
    		<div class="searchText">
    			<a href="#"></a>
    			<input id="searchText" type="text" placeholder="搜索 Meitu.com" />
    		</div>
    		<p class="fastLink">快速链接</p>
    		<a href="goods.html" class="searchTitle search_1">配件</a>
    		<a href="#" class="searchTitle search_2">售后维修网点</a>
    		<a href="#" class="searchTitle search_3">MeituFamily</a>
    		<a href="#" class="searchTitle search_4">体验店</a>
    </div>
    <div id="searchMask" class="searchDiv">
    </div>
    <!--
    	作者：offline
    	时间：2018-01-17
    	描述：nav导航栏部分
    -->
    <div id="navbox">
    	<div class="nav" id="nav">
    			<div href="" class="liparent logo" id="logo">
    				<a href="index.html" class="limask"></a>
    			</div>
    		<ul class="nav_content">
    			<li ><a class="a_content lichild1">手机</a> <a href="#" class="limask"></a></li>
    			<li><a class="a_content lichild1">配件</a> <a href="goods.html" class="limask"></a></li>
    			<li><a class="a_content lichild1">体验店</a> <a href="#" class="limask"></a></li>
    			<li><a class="a_content lichild1">个性定制</a> <a href="#" class="limask"></a></li>
    			<li><a class="a_content lichild1">服务支持</a> <a href="#" class="limask"></a></li>
    			<li><a class="a_content lichild1">美图公司</a> <a href="#" class="limask"></a></li>
    		</ul>
    		<ul class="nav_right">
	    			<li><a class="a_right lichild1"></a><a id="searchBtn" class="right_limask limask"></a></li>
	    			<li><a class="a_right lichild1"></a>
	    				<!--
					    	作者：offline
					    	时间：2018-01-18
					    	描述：我的菜单
					    -->
	    				<ul id="mybox" class="mybox">
					    	<li class="mybox_first">你的购物袋是空的</li>
					    	<li class="mybox_li"><i class="iconfont icon-gouwudai101"></i><a href="#">购物袋</a></li>
					    	<li class="mybox_li"><i class="iconfont icon-rili"></i><a href="#">我的预约</a></li>
					    	<li class="mybox_li"><i class="iconfont icon-zhengchangcaigoudingdan"></i><a href="#">我的订单</a></li>
					    	<li class="mybox_li"><i class="iconfont icon-saoma"></i><a href="login.html">S码通道</a></li>
					    	<li class="mybox_li"><i class="iconfont icon-denglu"></i><a href="login.html">登录</a></li>
					    	<div class="shangjian"></div>
   						 </ul>
	    				<a id="mineBtn" class="right_limask limask"></a>
	    			</li>
    		</ul>
    	</div>
    </div>
    <!--
    	作者：offline
    	时间：2018-01-22
    	描述：title标题
    -->
    <div class="content_title">
    	<p >
    		购物袋内的商品
    	</p>
    </div>
        <!--
    	作者：offline
    	时间：2018-01-22
    	描述：主体   商品详情部分
    -->
    
    <div  class="content">
    	<div id="content_box" class="content_box">
    		<div id="goods_box" class="goods_box">
    		</div>
    		<div class="payfor">
    			<p class="moneybox">总价:<span>RMB <span id="money"></span></span></p>
    			<p class="btnbox"><input type="button" id="payMoney" value="立即购买" /></p>
    		</div>
    	</div>
    </div>
    
</body>
</html>
<script type="text/javascript" src="js/jquery-1.8.3.min.js" ></script>
<script src="js/tools.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	//调用搜索框 控制 导航栏缩小动画
		navSacle();
	//调用展示，关闭  我的菜单动画
		showMy();
	$.ajax({
		url:"getShoppingCart.php",
		data:{"vipName":"18829038460"},
		dataType:"json",
		success:function(obj){
				let str = "";
				let zongjia = 0;
				for(let i = 0 ; i<obj.length ; i++){
					 goodsPrice = obj[i].goodsPrice;//单价
					 goodsCount = obj[i].goodsCount;//个数
					 goodsImgHref = obj[i].goodsImgHref;//图片路径
					 goodsName = obj[i].goodsName;//名称
					zongjia +=goodsCount*goodsPrice;
					str+="<div class='goods'><img src='"+goodsImgHref+"'/>"+
					"<div class='goods_content'><div class='goods_name_price'>"+
					"<a class='goodsName' href=''>"+goodsName+"</a><span class='rmb'>RMB <span class='goodsPrice'>"+goodsPrice+"</span></span></div>"+
					"<div class='reduce_plus'><i id='reduce' class='iconfont icon-jian1'></i><span class='goodsCount'>"+goodsCount+"</span><i id='plus' class='iconfont icon-jia'></i></div>"+
					"<div class='zong_price'>RMB<span class = 'zongjia'>"+goodsCount*goodsPrice+"</span></div></div>"+
					"<div class='close'><i id='usernameClose' class='iconfont icon-close-b'></i></div></div>";
				}
				$("#money").html(zongjia);
				$("#goods_box").append(str);
				
				//删除商品
				//
				deleteGoods();
				//商品数量加减
				//
				changeCount();
				
		},
	});
//
//删除商品函数
//
function deleteGoods(){
					let $close = $(".goods .close");
					for(let i = 0 ; i<$close.length;i++){
					$close.eq(i).on("click",()=>{
							$.ajax({
								type:"get",
								data:{
									"goodsPrice":$("#goods_box .goods .goodsPrice").eq(i).html(),
									"goodsCount":$("#goods_box .goods .goodsCount").eq(i).html(),
									"goodsImgHref":$("#goods_box img").eq(i).attr("src"),
									"goodsName":$("#goods_box .goods .goodsName").eq(i).html()
								},
								url:"deleteGoods.php",
								success:function(data){
									if(data==1){
											alert("删除成功！");
											location.href="myshopping.html";
									}else{
										alert("删除失败!");
									}
								}
							});
							$(this).parent().css({"display":"none"})
						})
					}
				}
//改变个数和总计
function changeCount(){
		$("#goods_box #reduce").each(function(i){
			$(this).on("click",function(){
				let num = parseInt($(".goodsCount").eq(i).html());
			if(num==1){
				return;
			}
			//改变个数
			$(".goodsCount").eq(i).html(num-1);
			//改变总价
			let money = (num-1)*parseInt($(".goodsPrice").eq(i).html());
			$(".zongjia").eq(i).html(money);
			//改变合计价格
				changeMoney();
			})
		});
		$("#goods_box #plus").each(function(i){
			$(this).on("click",function(){
				let num = parseInt($(".goodsCount").eq(i).html());
				$(".goodsCount").eq(i).html(num+1);
				let money = (num+1)*parseInt($(".goodsPrice").eq(i).html());
				$(".zongjia").eq(i).html(money);
				//改变合计价格
				changeMoney();
			})
		});
}
//改变 合计
function changeMoney(){
						let zongMoney = 0;
						$("#goods_box .zongjia").each(function(i){
							zongMoney+=parseInt($(this).html());
						});
						$("#money").html(zongMoney);
					}
						
</script>